<html>

<head>
      <meta charset="UTF-8">
<style type="text/css">
  #target {
    width: 1024px;
    height: 512px;
    position: absolute;
    background: rgba(255,255,0,0.3);
    background: black;
  }

  #htmlTarget.hide {
    z-index: -1;
  }

  #target h1 {
    font-family: Arial;
    font-size: 16px;
    margin: 5;
    vertical-align: top;
    color: white;
  }


  #target h1 span {
    color: black;
  }

  #emoji {
    position: absolute;
    font-size: 512px;
    color: mediumTurquoise;
    font-style: serif;
  }

  #pre {
    font-family: arial;
    margin: 5;
    padding: 0;
    height: 14px;
    font-size: 14px;
    background: royalblue;
    color: white;
  }

  #districtInfo {
    font-family: Arial;
    margin: 5;
    padding: 2;
    height: 14px;
    font-size: 12px;
    background: black;
    color: white;
  }

  #htmlTarget {
    position: absolute;
    z-index: 1;
    height: 100%;
    width: 100%;
    overflow: hidden;
  }

  #debug {
    position: absolute;
    bottom: 0;
    left: 0;
  }

  @media (max-width: 512px) {
    #target {
      width: 256px;
      height: 126px;
    }

    #target h1 {
      font-size: 55px;
    }

    #pre {
      height: 50px;
      font-size: 25px;
    }

    #emoji {
      position: absolute;
      font-size: 256px;
      color: mediumTurquoise;
    }
  }

  body[data-vr="true"] .novr{
    display: none;
  }
  </style>
    <title>CityViewR</title>
    <script src="js/aframe-map.js"></script>
    <script src="js/aframe-bmfont-text-component.js"></script>
      <script src="js/aframe-vive-cursor-component.min.js"></script>
    <script src="js/skyGradient.js"></script>
    <!--
    <script src="js/aframe-layout-component.min.js"></script>-->
    <script src="js/aframe-draw-component.min.js"></script>
    <!--<script src="js/aframe-html-shader.min.js"></script>-->
    <script src="js/aframe-htmltexture-component.min.js"></script>
  <!--  <script src="js/aframe-fit-texture-component.min.js"></script>-->

    <!--<script src="js/aframe-textwrap-component.min.js"></script>-->

    <script>
        //  var venueCache = {};
        var districtCache = {};
        var CBSvarCache = {};
        var IsSelected = {};
        var variables = [];
        var menuData = [];
        var menuLookup = {};
        var dataLookup = {};
        var varTitleLookup = {};

        function find(array, id) {
            if (typeof array != 'undefined') {
                for (var i = 0; i < array.length; i++) {
                    if (array[i].ID == id) return [id];
                    var a = find(array[i].children, id);
                    if (a != null) {
                        a.unshift(array[i].ID);
                        return a;
                    }
                }
            }
            return null;
        }


        AFRAME.registerComponent('submenu', {
            schema: {
                default: ''
            },
            init() {
                this.el.setAttribute('transparent', true);
                this.el.setAttribute('opacity', 0.2);
                this.el.setAttribute('selected', false);
                this.el.addEventListener('click', () => {
                    var menuButtons = document.getElementsByClassName('menubutton');
                    if (this.data != 'noAction'){
                    for (var i = 0; i < menuButtons.length; i++) {
                        menuButtons[i].setAttribute('visible', false);
                    }
                    var menuItem = menuLookup[this.data];
                    var parents = find(menuData, this.data);
                    if (menuItem.ID == 999) {
                        fillMenuButton(menuItem.Title, menuItem.ID, 0, 'Parent', '');
                        var childItems = menuItem.children;
                        for (var i = 0; i < childItems.length; i++) {
                            var j = i + 1;
                            fillMenuButton(childItems[i].Title, childItems[i].ID, j, childItems[i].Type,childItems[i].Key);
                        }
                    } else {
                        var level = parents.length;
                        for (var i = 0; i < parents.length; i++) {
                            var item = menuLookup[parents[i]];
                            fillMenuButton(item.Title, item.ID, i, 'Parent', item.Key);
                        }
                        var menuItem = menuLookup[this.data];
                        var childItems = menuItem.children;
                        for (var i = 0; i < childItems.length; i++) {
                            var j = i + level;
                            fillMenuButton(childItems[i].Title, childItems[i].ID, j, childItems[i].Type, childItems[i].Key);
                        }
                    }
                  }
                    });


            }
        });

        AFRAME.registerComponent('bar', {
            schema: {
                default: ''
            },
            init() {
                this.el.setAttribute('transparent', true);
                this.el.setAttribute('opacity', .85);
                this.el.setAttribute('selected', false);
                this.el.addEventListener('click', () => {
                    writeDistrictInfo(this.data);
                });
            }
        });

        AFRAME.registerComponent('selectvar', {
            schema: {
                default: ''
            },
            init() {
              this.el.addEventListener('click', () => {
              if (this.el.material == 'src: #checked;side:double;'){
                this.el.setAttribute('material', 'src: #unchecked;side:double;');
              } else {
                this.el.setAttribute('material', 'src: #checked;side:double;');
              }
              console.log('clicked');
              var menuItem = menuLookup[this.data];
              console.log(menuItem.Key);
            });
          }
        });

        function writeDistrictInfo(id){
          var districtInfo = document.getElementById('districtInfo');
          var district = document.getElementById('pre');
          district.innerHTML =  'Amsterdam: '+ districtCache[id]['name'];
          var str = '<table style="width:100%; background: black;">';
          var barColors = chroma.scale('YlOrBr').colors(queryData.length);
          for (var i=0; i<queryData.length;i++){
            str = str + '<tr><td><span style="color:' + barColors[i] + '";>&#9632; </span><span style="color:white; font-size:12px;">' + varTitleLookup[queryData[i]] + ': </span></td>';
            str = str + '<td><span style="color:white; font-size:12px";>' +dataLookup[id][queryData[i]] + '</span></td></tr>';
          }
          str = str + '</table>';
          districtInfo.innerHTML = str;
          console.log(varTitleLookup);
        }
    </script>
</head>

<body>

    <a-scene id="scene" fog="color: #bc483e; near: 0; far: 25;" antialias='true'>
      <a-assets>
        <img id="checked" src="js/checked.jpg">
        <img id="unchecked" src="js/unchecked.jpg">
        <div id="target">
          <h1>CityViewR</h1>
          <span id="pre">Amsterdam</span>
          <div id="districtInfo"> </div>
        </div>
      </a-assets>
        <a-map width="7" height="4" position="0 0 -1" rotation="-90 0 0">
            <a-sphere id="current-location" color="#00f" position="0 0 0" visible="false" radius="0.01"></a-sphere>
        </a-map>

        <a-plane id="selection_panel" color="black" position="-1.5 1 .6" rotation="-30 45 0" width="1.3" height="1" visible="true">
        </a-plane>

        <a-entity id="infopanel" geometry="primitive:plane;width:4;height:2;" rotation="0 0 0" position="0 1.5 -4.5" htmltexture="asset: #target"></a-entity>

        <!--
        <a-entity vive-controls="hand: left" vive-cursor></a-entity>
        <a-entity vive-controls="hand: right" vive-cursor></a-entity>
      -->
        <a-light position="-1 5 0"></a-light>
        <a-light type="point" position="1 1 -0.37" intensity=".5"></a-light>
        <a-light type="point" position="0 2 -1.7" intensity=".5"></a-light>
        <a-light type="point" position="0 2 1.7" intensity=".5"></a-light>
        <a-light type="ambient" intensity=".4"></a-light>

        <!--<a-sky color="#fff"></a-sky>-->
        <a-entity id="sky" geometry="primitive: sphere; radius: 50;" material="shader: skyGradient; colorTop: #353449; colorBottom: #BC483E; side: back"></a-entity>

        <a-entity position="0 0 1">
            <a-camera look-controls wasd-controls>
                <a-cursor id="cursor" color="#4CC3D9" fuse="true" fuseTimeout="750"></a-cursor>
            </a-camera>
        </a-entity>

    </a-scene>



    <script src="js/loadJSON.js"></script>
    <script src="js/TweenMax.min.js"></script>
    <script src="js/chroma.min.js"></script>
    <script src="js/geturlparameters.js"></script>
    <script src="js/geojson-vt.js"></script>
    <script src="https://npmcdn.com/@turf/turf@3.5.1/turf.min.js" charset="utf-8"></script>
    <script src="style.js"></script>
    <!--
	<script src="https://rawgit.com/ngokevin/aframe-animation-component/master/dist/aframe-animation-component.min.js"></script> 
  <script src="https://rawgit.com/gmarty/aframe-ui-components/master/dist/aframe-ui-components.min.js"></script> 
-->
    <script src="cityviewr.js"></script>


</body>

</html>
